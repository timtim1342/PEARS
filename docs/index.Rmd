---
title: "Plots"
output:
  html_document:
    toc: true
    theme: united
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(DT)

# prepare data
data = read_tsv('ad_values.csv')
# kina rutul
data %>% 
  filter(lang=='kna') -> kna_data
# kna_data %>% 
#   filter(dem != 'SELF') -> kna_data  # only for demonstartives
# mehweb dargwa
data %>% 
  filter(lang=='mhb') -> mhb_data

dems_order = c("PROX", "MED", "DIST", "ABOVE", "BELOW")


```

# General summary

## Tables

```{r echo=FALSE}
data$dem = factor(data$dem)
data$synt_pos = factor(data$synt_pos)
data$lang = factor(data$lang)
data$anim = factor(data$anim)
data$anaphor_device = factor(data$anaphor_device)
data$anaphor_referent = factor(data$anaphor_referent)
data$previous_device = factor(data$previous_device)
data$previous_referent = factor(data$previous_referent)
data$filename = factor(data$filename)

data %>% 
  datatable(class = 'cell-border stripe', 
    rownames = FALSE, 
    filter = 'top', 
    extensions = 'Buttons',
    options = list(pageLength = 5, 
                   autoWidth = TRUE, 
                   scrollX = TRUE,
                   info = FALSE,
                   dom = 'fBltp',
                   buttons = list(list(extend = 'collection',
                                       buttons = c('csv', 'excel', 'pdf'),
                                       text = '<i class="fas fa-download"></i>')),
                   paginate = TRUE))
```

### Kina Rutul

```{r echo=FALSE, message=FALSE}
kna_data %>%
  group_by(dem, synt_pos) %>% 
  summarise(n=n())
kna_data %>%
  group_by(synt_pos) %>% 
  summarise(n=n())
kna_data %>%
  group_by(dem) %>% 
  summarise(n=n())
```

### Mehweb Dargwa

```{r echo=FALSE, message=FALSE}
mhb_data %>%
  group_by(dem, synt_pos) %>% 
  summarise(n=n())
mhb_data %>%
  group_by(synt_pos) %>% 
  summarise(n=n())
mhb_data %>%
  group_by(dem) %>% 
  summarise(n=n())
```

## Plots

```{r include=FALSE}
# prepare data
data %>% 
  filter(synt_pos=='INDEP') %>% 
  filter(dem != 'SELF') %>% 
  group_by(lang, dem) %>% 
  summarise(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) -> general_indep_plot1
kna_data %>%
  group_by(dem, synt_pos) %>% 
  summarise(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) -> kna_data_plot1_per_dems
kna_data %>%
  group_by(synt_pos, dem) %>% 
  summarise(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) -> kna_data_plot1_per_synt_pos
mhb_data %>%
  group_by(dem, synt_pos) %>% 
  summarise(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) -> mhb_data_plot1_per_dems
mhb_data %>%
  group_by(synt_pos, dem) %>% 
  summarise(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) -> mhb_data_plot1_per_synt_pos


# per speaker
kna_data %>%
  group_by(filename, dem) %>% 
  summarise(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n)) -> kna_data_speaker_overall
kna_data_speaker_overall$filename = str_replace(kna_data_speaker_overall$filename, '.TextGrid', '')
kna_data_speaker_overall$filename = str_replace(kna_data_speaker_overall$filename, 'kna_pears_', '')
mhb_data %>%
  group_by(filename, dem) %>% 
  summarise(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n)) -> mhb_data_speaker_overall
mhb_data_speaker_overall$filename = str_replace(mhb_data_speaker_overall$filename, '.TextGrid', '')
mhb_data_speaker_overall$filename = str_replace(mhb_data_speaker_overall$filename, 'mhb_pears_', '')


# per speaker
kna_data %>%
  filter(synt_pos=='INDEP') %>% 
  group_by(filename, dem) %>% 
  summarise(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n)) -> kna_data_plot2
kna_data_plot2$filename = str_replace(kna_data_plot2$filename, '.TextGrid', '')
kna_data_plot2$filename = str_replace(kna_data_plot2$filename, 'kna_pears_', '')
mhb_data %>%
  filter(synt_pos=='INDEP') %>% 
  group_by(filename, dem) %>% 
  summarise(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n)) -> mhb_data_plot2
mhb_data_plot2$filename = str_replace(mhb_data_plot2$filename, '.TextGrid', '')
mhb_data_plot2$filename = str_replace(mhb_data_plot2$filename, 'mhb_pears_', '')

kna_data %>%
  filter(synt_pos=='ADNOM') %>% 
  group_by(filename, dem) %>% 
  summarise(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n)) -> kna_data_plot2_adn
kna_data_plot2_adn$filename = str_replace(kna_data_plot2_adn$filename, '.TextGrid', '')
kna_data_plot2_adn$filename = str_replace(kna_data_plot2_adn$filename, 'kna_pears_', '')
mhb_data %>%
  filter(synt_pos=='ADNOM') %>% 
  group_by(filename, dem) %>% 
  summarise(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n)) -> mhb_data_plot2_adn
mhb_data_plot2_adn$filename = str_replace(mhb_data_plot2_adn$filename, '.TextGrid', '')
mhb_data_plot2_adn$filename = str_replace(mhb_data_plot2_adn$filename, 'mhb_pears_', '')

# general
data %>% 
  group_by(lang, dem) %>% 
  summarise(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))->general_all
```

### All uses

```{r echo=FALSE}
ggplot(general_all, aes(x=lang, y=perc, fill=factor(dem, dems_order))) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  #scale_fill_brewer(palette="Set1")+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77", "ABOVE"="#E7298A", "BELOW"="#666666"))+
  theme_minimal()+
  ggtitle("All uses of demonstratives")+
  labs(fill = "Reference-tracking device")+
  xlab("Language")+
  ylab("Percentage (per language)")
```

### Mehweb Dargwa uses (based on abk_1, zkh_3, ptm_8, kzm_4, isr_5, mgm_6)

```{r include=FALSE}
mhb_target = c('abk_1', 'zkh_3', 'ptm_8', 'kzm_4', 'isr_5', 'mgm_6')
mhb_data$filename = str_replace(mhb_data$filename, '.TextGrid', '')
mhb_data$filename = str_replace(mhb_data$filename, 'mhb_pears_', '')

mhb_data %>% 
  filter(filename %in% mhb_target) %>% 
  group_by(lang, dem) %>% 
  summarise(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))->general_all_not_al

```

```{r echo=FALSE}
ggplot(general_all_not_al, aes(x=lang, y=perc, fill=factor(dem, dems_order))) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  #scale_fill_brewer(palette="Set1")+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77", "ABOVE"="#E7298A", "BELOW"="#666666"))+
  theme_minimal()+
  ggtitle("Mehweb Dargwa uses of demonstratives (based on abk_1, zkh_3, ptm_8, kzm_4, isr_5, mgm_6)")+
  labs(fill = "Reference-tracking device")+
  xlab("Language")+
  ylab("Percentage (per language)")
```

### Number of uses of each demonstrative in the independent position

```{r echo=FALSE}
ggplot(general_indep_plot1, aes(x=lang, y=perc, fill=factor(dem, dems_order))) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  #scale_fill_brewer(palette="Set1")+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77", "ABOVE"="#E7298A", "BELOW"="#666666"))+
  theme_minimal()+
  ggtitle("Independent uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Language")+
  ylab("Percentage (per language)")
```

### Syntactic positions per demonstratives

```{r echo=FALSE}
ggplot(kna_data_plot1_per_dems, aes(x=factor(dem, dems_order), y=perc, fill=synt_pos)) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  #scale_fill_brewer(palette="Set1")+
  scale_fill_manual( values = c("ADNOM" = "#E41A1C","INDEP" = "#377EB8"))+
  theme_minimal()+
  ggtitle("Kina Rutul")+
  labs(fill = "Syntactic position")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

```{r echo=FALSE}
ggplot(mhb_data_plot1_per_dems, aes(x=factor(dem, dems_order), y=perc, fill=synt_pos)) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  #scale_fill_brewer(palette="Set1")+
  scale_fill_manual( values = c("ADNOM" = "#E41A1C","INDEP" = "#377EB8"))+
  theme_minimal()+
  ggtitle("Mehweb Dargwa")+
  labs(fill = "Syntactic position")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

### Demonstratives per syntactic position

```{r echo=FALSE}
ggplot(kna_data_plot1_per_synt_pos, aes(x=synt_pos, y=perc, fill=factor(dem, dems_order))) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  #scale_fill_brewer(palette="Dark2")+
  theme_minimal()+
  ggtitle("Kina Rutul")+
  labs(fill = "Reference-tracking device")+
  xlab("Syntactic position")+
  ylab("Percentage (per synt. position)")
```

```{r echo=FALSE}
ggplot(mhb_data_plot1_per_synt_pos, aes(x=synt_pos, y=perc, fill=factor(dem, dems_order))) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77", "ABOVE"="#E7298A", "BELOW"="#666666"))+
  #scale_fill_brewer(palette="Dark2")+
  theme_minimal()+
  ggtitle("Mehweb Dargwa")+
  labs(fill = "Reference-tracking device")+
  xlab("Syntactic position")+
  ylab("Percentage (per synt. position)")
```

```{r include=FALSE}
mhb_data %>%
  filter(filename %in% mhb_target) %>% 
  group_by(synt_pos, dem) %>% 
  summarise(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) -> mhb_data_plot1_per_synt_pos_not_all
```

```{r echo=FALSE}
ggplot(mhb_data_plot1_per_synt_pos_not_all, aes(x=synt_pos, y=perc, fill=factor(dem, dems_order))) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77", "ABOVE"="#E7298A", "BELOW"="#666666"))+
  #scale_fill_brewer(palette="Dark2")+
  theme_minimal()+
  ggtitle("Mehweb Dargwa (based on abk_1, zkh_3, ptm_8, kzm_4, isr_5, mgm_6)")+
  labs(fill = "Reference-tracking device")+
  xlab("Syntactic position")+
  ylab("Percentage (per synt. position)")
```

### Demonstratives per speaker (sorted by the total number of uses)

```{r echo=FALSE}
ggplot(kna_data_speaker_overall, aes(x=reorder(filename, -total_n_ref_dev), y=perc, fill=factor(dem, dems_order))) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 45, hjust=1))+
  ggtitle("Kina Rutul")+
  labs(fill = "Reference-tracking device")+
  xlab("Speaker/text")+
  ylab("Percentage (per speaker/text)")
```

```{r echo=FALSE}
ggplot(mhb_data_speaker_overall, aes(x=reorder(filename, -total_n_ref_dev), y=perc, fill=factor(dem, dems_order))) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77", "ABOVE"="#E7298A", "BELOW"="#666666"))+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 45, hjust=1))+
  ggtitle("Mehweb Dargwa")+
  labs(fill = "Reference-tracking device")+
  xlab("Speaker/text")+
  ylab("Percentage (per speaker/text)")
```

### Independent demonstratives per speaker (sorted by the total number of uses)

```{r echo=FALSE}
ggplot(kna_data_plot2, aes(x=reorder(filename, -total_n_ref_dev), y=perc, fill=factor(dem, dems_order))) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 45, hjust=1))+
  ggtitle("Kina Rutul")+
  labs(fill = "Reference-tracking device")+
  xlab("Speaker/text")+
  ylab("Percentage (per speaker/text)")
```

```{r echo=FALSE}
ggplot(mhb_data_plot2, aes(x=reorder(filename, -total_n_ref_dev), y=perc, fill=factor(dem, dems_order))) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77", "ABOVE"="#E7298A", "BELOW"="#666666"))+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 45, hjust=1))+
  ggtitle("Mehweb Dargwa")+
  labs(fill = "Reference-tracking device")+
  xlab("Speaker/text")+
  ylab("Percentage (per speaker/text)")
```

### Adnominal demonstratives per speaker (sorted by the total number of uses)

```{r echo=FALSE}
ggplot(kna_data_plot2_adn, aes(x=reorder(filename, -total_n_ref_dev), y=perc, fill=factor(dem, dems_order))) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 45, hjust=1))+
  ggtitle("Kina Rutul")+
  labs(fill = "Reference-tracking device")+
  xlab("Speaker/text")+
  ylab("Percentage (per speaker/text)")
```

```{r echo=FALSE}
ggplot(mhb_data_plot2_adn, aes(x=reorder(filename, -total_n_ref_dev), y=perc, fill=factor(dem, dems_order))) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77", "ABOVE"="#E7298A", "BELOW"="#666666"))+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 45, hjust=1))+
  ggtitle("Mehweb Dargwa")+
  labs(fill = "Reference-tracking device")+
  xlab("Speaker/text")+
  ylab("Percentage (per speaker/text)")
```

# Anaphoric Distance

```{r include=FALSE}
# prepare data
dem_target = c('PROX', 'MED', 'DIST')
kna_data %>% 
  filter(synt_pos=='INDEP') -> kna_data_plot3
kna_data_plot3$filename = str_replace(kna_data_plot3$filename, '.TextGrid', '')
kna_data_plot3$filename = str_replace(kna_data_plot3$filename, 'kna_pears_', '')
# kna_target = c('sai_9', 'shk_10', 'hdz_7', 'ldm_4', 'rhn_12', 'man_13')
# kna_target = c('saa_8', 'vdm_3')
# kna_data_plot3 %>% 
#   filter(filename %in% kna_target) -> kna_data_plot3
kna_data %>% 
  filter(synt_pos=='ADNOM') -> kna_data_plot3_adn
kna_data_plot3_adn$filename = str_replace(kna_data_plot3_adn$filename, '.TextGrid', '')
kna_data_plot3_adn$filename = str_replace(kna_data_plot3_adn$filename, 'kna_pears_', '')

mhb_data %>% 
  filter(synt_pos=='INDEP') %>% 
  filter(dem %in% dem_target)-> mhb_data_plot3
mhb_data_plot3$filename = str_replace(mhb_data_plot3$filename, '.TextGrid', '')
mhb_data_plot3$filename = str_replace(mhb_data_plot3$filename, 'mhb_pears_', '')
mhb_data %>% 
  filter(dem %in% dem_target) %>% 
  filter(synt_pos=='ADNOM') -> mhb_data_plot3_adn
mhb_data_plot3_adn$filename = str_replace(mhb_data_plot3_adn$filename, '.TextGrid', '')
mhb_data_plot3_adn$filename = str_replace(mhb_data_plot3_adn$filename, 'mhb_pears_', '')
```

## Kina Rutul

### Independent position

#### (N)AD
##### Seconds

```{r echo=FALSE}
kna_data_plot3 %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(ad_seconds), n=n())
```

```{r echo=FALSE}
ggplot(kna_data_plot3, aes(x=factor(dem, dems_order), y=ad_seconds, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual(values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  ggtitle("Kina Rutul: (N)AD in seconds for independent uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (seconds)")
```

##### Words

```{r echo=FALSE}
kna_data_plot3 %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(ad), n=n())
```

```{r echo=FALSE}
ggplot(kna_data_plot3, aes(x=factor(dem, dems_order), y=ad, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual(values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  ggtitle("Kina Rutul: (N)AD in words for independent uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (words)")
```

#### WAD
##### Seconds

```{r echo=FALSE}
kna_data_plot3 %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(wad_seconds), n=n())
```

```{r echo=FALSE}
ggplot(kna_data_plot3, aes(x=factor(dem, dems_order), y=wad_seconds, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual(values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  ggtitle("Kina Rutul: WAD in seconds for independent uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (seconds)")
```

##### Words

```{r echo=FALSE}
kna_data_plot3 %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(wad), n=n())
```

```{r echo=FALSE}
ggplot(kna_data_plot3, aes(x=factor(dem, dems_order), y=wad, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual(values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  ggtitle("Kina Rutul: WAD in words for independent uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (words)")
```

### Adnominal position

#### (N)AD
##### Seconds

```{r echo=FALSE}
kna_data_plot3_adn %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(ad_seconds), n=n())
```

```{r echo=FALSE}
ggplot(kna_data_plot3_adn, aes(x=factor(dem, dems_order), y=ad_seconds, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual(values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  ggtitle("Kina Rutul: (N)AD in seconds for adnominal uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (seconds)")
```

##### Words

```{r echo=FALSE}
kna_data_plot3_adn %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(ad), n=n())
```

```{r echo=FALSE}
ggplot(kna_data_plot3_adn, aes(x=factor(dem, dems_order), y=ad, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual(values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  ggtitle("Kina Rutul: (N)AD in words for adnominal uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (words)")
```

#### WAD
##### Seconds

```{r echo=FALSE}
kna_data_plot3_adn %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(wad_seconds), n=n())
```

```{r echo=FALSE}
ggplot(kna_data_plot3_adn, aes(x=factor(dem, dems_order), y=wad_seconds, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual(values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  ggtitle("Kina Rutul: WAD in seconds for adnominal uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (seconds)")
```

##### Words

```{r echo=FALSE}
kna_data_plot3_adn %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(wad), n=n())
```

```{r echo=FALSE}
ggplot(kna_data_plot3_adn, aes(x=factor(dem, dems_order), y=wad, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual(values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  ggtitle("Kina Rutul: WAD in words for adnominal uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (words)")
```

## Mehweb Dargwa

```{r echo=FALSE}
mhb_target_clauses = c('abk_1', 'zkh_3', 'ptm_8', 'kzm_4')
mhb_target = c('abk_1', 'zkh_3', 'ptm_8', 'kzm_4', 'isr_5', 'mgm_6')

mhb_data_plot3 %>% 
  filter(filename %in% mhb_target_clauses)->mhb_data_plot3_clauses
mhb_data_plot3_adn %>% 
  filter(filename %in% mhb_target_clauses)->mhb_data_plot3_clauses_adn

mhb_data_plot3 %>% 
  filter(filename %in% mhb_target)->mhb_data_plot3
mhb_data_plot3_adn %>% 
  filter(filename %in% mhb_target)->mhb_data_plot3_adn
```

### Cf. GivÃ³n's

#### Adnominal

```{r echo=FALSE}
mhb_data %>% 
  filter(synt_pos=='ADNOM') %>% 
  summarise(mean_distance=mean(ad_clauses), n=n(), sd=sd(ad_clauses), med=median(ad_clauses))
```

#### Independent

```{r echo=FALSE}
mhb_data %>% 
  filter(synt_pos=='INDEP') %>% 
  summarise(mean_distance=mean(ad_clauses), n=n(), sd=sd(ad_clauses), med=median(ad_clauses))
```

#### All

```{r echo=FALSE}
ggplot(mhb_data, aes(x=synt_pos, y=ad_clauses, fill=synt_pos)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="white")+
  scale_fill_manual( values = c("ADNOM" = "#E41A1C","INDEP" = "#377EB8"))+
  theme_minimal()+
  ggtitle("Mehweb Dargwa: (N)AD")+
  labs(fill = "Syntactic position")+
  xlab("Syntactic position")+
  ylab("Anaphoric distance (clauses)")
```

### Independent position

#### (N)AD
##### Seconds (based on abk_1, zkh_3, ptm_8, kzm_4, isr_5, mgm_6)

```{r echo=FALSE}
mhb_data_plot3 %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(ad_seconds), n=n())
```

```{r echo=FALSE}
ggplot(mhb_data_plot3, aes(x=factor(dem, dems_order), y=ad_seconds, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+  # , "ABOVE"="#E7298A", "BELOW"="#666666"
  theme_minimal()+
  ggtitle("Mehweb Dargwa: (N)AD in seconds for independent uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (seconds)")
```

##### Words (based on abk_1, zkh_3, ptm_8, kzm_4, isr_5, mgm_6)

```{r echo=FALSE}
mhb_data_plot3 %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(ad), n=n())
```

```{r echo=FALSE}
ggplot(mhb_data_plot3, aes(x=factor(dem, dems_order), y=ad, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  ggtitle("Mehweb Dargwa: (N)AD in words for independent uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (words)")
```

##### Clauses (based on abk_1, zkh_3, ptm_8, kzm_4)

```{r echo=FALSE}
mhb_data_plot3_clauses %>% 
  summarise(mean_distance=mean(ad_clauses), n=n(), sd=sd(ad_clauses), med=median(ad_clauses))
```

```{r echo=FALSE}
mhb_data_plot3_clauses %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(ad_clauses), n=n())
```

```{r echo=FALSE}
ggplot(mhb_data_plot3_clauses, aes(x=factor(dem, dems_order), y=ad_clauses, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  ggtitle("Mehweb Dargwa: (N)AD in clauses for independent uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (clauses)")
```

#### WAD
##### Seconds (based on abk_1, zkh_3, ptm_8, kzm_4, isr_5, mgm_6)

```{r echo=FALSE}
mhb_data_plot3 %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(wad_seconds), n=n())
```

```{r echo=FALSE}
ggplot(mhb_data_plot3, aes(x=factor(dem, dems_order), y=wad_seconds, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+  # , "ABOVE"="#E7298A", "BELOW"="#666666"
  theme_minimal()+
  ggtitle("Mehweb Dargwa: WAD in seconds for independent uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (seconds)")
```

##### Words (based on abk_1, zkh_3, ptm_8, kzm_4, isr_5, mgm_6)

```{r echo=FALSE}
mhb_data_plot3 %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(wad), n=n())
```

```{r echo=FALSE}
ggplot(mhb_data_plot3, aes(x=factor(dem, dems_order), y=wad, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  ggtitle("Mehweb Dargwa: WAD in words for independent uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (words)")
```

##### Clauses (based on abk_1, zkh_3, ptm_8, kzm_4)

```{r echo=FALSE}
mhb_data_plot3_clauses %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(wad_clauses), n=n())
```

```{r echo=FALSE}
ggplot(mhb_data_plot3_clauses, aes(x=factor(dem, dems_order), y=wad_clauses, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  ggtitle("Mehweb Dargwa: WAD in clauses for independent uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (clauses)")
```

### Adnominal position

#### (N)AD
##### Seconds (based on abk_1, zkh_3, ptm_8, kzm_4, isr_5, mgm_6)

```{r echo=FALSE}
mhb_data_plot3_adn %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(ad_seconds), n=n())
```

```{r echo=FALSE}
ggplot(mhb_data_plot3_adn, aes(x=factor(dem, dems_order), y=ad_seconds, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+  # , "ABOVE"="#E7298A", "BELOW"="#666666"
  theme_minimal()+
  ggtitle("Mehweb Dargwa: (N)AD in seconds for adnominal uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (seconds)")
```

##### Words (based on abk_1, zkh_3, ptm_8, kzm_4, isr_5, mgm_6)

```{r echo=FALSE}
mhb_data_plot3_adn %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(ad), n=n())
```

```{r echo=FALSE}
ggplot(mhb_data_plot3_adn, aes(x=factor(dem, dems_order), y=ad, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  ggtitle("Mehweb Dargwa: (N)AD in words for adnominal uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (words)")
```

##### Clauses (based on abk_1, zkh_3, ptm_8, kzm_4)

```{r echo=FALSE}
mhb_data_plot3_clauses_adn %>% 
  summarise(mean_distance=mean(ad_clauses), n=n(), sd=sd(ad_clauses), med=median(ad_clauses))
```

```{r echo=FALSE}
mhb_data_plot3_clauses_adn %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(ad_clauses), n=n())
```

```{r echo=FALSE}
ggplot(mhb_data_plot3_clauses_adn, aes(x=factor(dem, dems_order), y=ad_clauses, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  ggtitle("Mehweb Dargwa: (N)AD in clauses for adnominal uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (clauses)")
```

#### WAD
##### Seconds (based on abk_1, zkh_3, ptm_8, kzm_4, isr_5, mgm_6)

```{r echo=FALSE}
mhb_data_plot3_adn %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(wad_seconds), n=n())
```

```{r echo=FALSE}
ggplot(mhb_data_plot3_adn, aes(x=factor(dem, dems_order), y=wad_seconds, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+  # , "ABOVE"="#E7298A", "BELOW"="#666666"
  theme_minimal()+
  ggtitle("Mehweb Dargwa: WAD in seconds for adnominal uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (seconds)")
```

##### Words (based on abk_1, zkh_3, ptm_8, kzm_4, isr_5, mgm_6)

```{r echo=FALSE}
mhb_data_plot3_adn %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(wad), n=n())
```

```{r echo=FALSE}
ggplot(mhb_data_plot3_adn, aes(x=factor(dem, dems_order), y=wad, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  ggtitle("Mehweb Dargwa: WAD in words for adnominal uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (words)")
```

##### Clauses (based on abk_1, zkh_3, ptm_8, kzm_4)

```{r echo=FALSE}
mhb_data_plot3_clauses_adn %>% 
  group_by(dem) %>% 
  summarise(mean_distance=mean(wad_clauses), n=n())
```

```{r echo=FALSE}
ggplot(mhb_data_plot3_clauses_adn, aes(x=factor(dem, dems_order), y=wad_clauses, fill=dem)) + 
  geom_boxplot()+
  stat_summary(fun=mean, geom="point", size=2, color="red")+
  scale_fill_manual( values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  ggtitle("Mehweb Dargwa: WAD in clauses for adnominal uses")+
  labs(fill = "Reference-tracking device")+
  xlab("Reference-tracking device")+
  ylab("Anaphoric distance (clauses)")
```

# Discourse Functions

## Kina Rutul

```{r include=FALSE}
kna_data %>%
  filter(synt_pos=="INDEP") %>%
  group_by(dem, anaphor_referent) %>%
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))->kna_data_referent
```

```{r echo=FALSE}
ggplot(kna_data_referent, aes(x=factor(dem, dems_order), y=perc, fill=anaphor_referent)) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  #scale_fill_brewer(palette="Set1")+
  scale_fill_manual( values = c("boy" = "#2F4F4F","man" = "#D3D3D3", "boys" ="#A9A9A9",
                                "man2" = "#8A2BE2", "boy1"= "#FF69B4", "girl" = "#800080",
                                "basket" = "#006400", "bike" = "#20B2AA", "hat" = "#66CDAA", "stone" = "#87CEEB", "scarf" = "#808000","pears" = "#00008B"))+
  theme_minimal()+
  ggtitle("Independent uses")+
  labs(fill = "Referents")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

```{r include=FALSE}
kna_data %>%
  filter(synt_pos=="ADNOM") %>%
  group_by(dem, anaphor_referent) %>%
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))->kna_data_referent_adn
```

```{r echo=FALSE}
ggplot(kna_data_referent_adn, aes(x=factor(dem, dems_order), y=perc, fill=anaphor_referent)) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  #scale_fill_brewer(palette="Set1")+
  scale_fill_manual( values = c("boy" = "#2F4F4F","man" = "#D3D3D3", "boys" ="#A9A9A9",
                                "man2" = "#8A2BE2", "boy1"= "#FF69B4", "girl" = "#800080",
                                "basket" = "#006400", "bike" = "#20B2AA", "hat" = "#66CDAA", "stone" = "#87CEEB", "scarf" = "#808000","pears" = "#00008B"))+
  theme_minimal()+
  ggtitle("Adnominal uses")+
  labs(fill = "Referents")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

```{r include=FALSE}
kna_data %>%
  filter(grepl('_NP|NP', previous_explicit_device))%>% 
  filter(synt_pos=="INDEP") %>% 
  group_by(dem, previous_explicit_mention) %>% 
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))-> kna_data_mention
kna_data_mention$previous_explicit_mention = str_replace(kna_data_mention$previous_explicit_mention, '1', '2')

```

```{r echo=FALSE}
ggplot(kna_data_mention, aes(x=factor(dem, dems_order), y=perc, fill=previous_explicit_mention)) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  #scale_fill_brewer(palette="Set1")+
  scale_fill_manual( values = c(">2" = "#E9999C","2" = "#AEEEEE"))+
  theme_minimal()+
  ggtitle("Independent uses")+
  labs(fill = "Number of the current (explicit) mention")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

```{r include=FALSE}
kna_data %>%
  filter(grepl('_NP|NP', previous_explicit_device))%>% 
  filter(synt_pos=="ADNOM") %>% 
  group_by(dem, previous_explicit_mention) %>% 
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))-> kna_data_mention
kna_data_mention$previous_explicit_mention = str_replace(kna_data_mention$previous_explicit_mention, '1', '2')

```

```{r echo=FALSE}
ggplot(kna_data_mention, aes(x=factor(dem, dems_order), y=perc, fill=previous_explicit_mention)) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  #scale_fill_brewer(palette="Set1")+
  scale_fill_manual( values = c(">2" = "#E9999C","2" = "#AEEEEE"))+
  theme_minimal()+
  ggtitle("Adnominal uses")+
  labs(fill = "Number of the current (explicit) mention")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

```{r include=FALSE}
kna_data %>%
  group_by(filename, length_words, dem) %>%
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))-> kna_data_length
kna_data_length$filename = str_replace(kna_data_length$filename, '.TextGrid', '')
kna_data_length$filename = str_replace(kna_data_length$filename, 'kna_pears_', '')
kna_data_length$new_filename = paste(kna_data_length$filename, kna_data_length$length_words, sep=':')
```

```{r echo=FALSE}
ggplot(kna_data_length, aes(x=reorder(new_filename, length_words), y=n, fill=dem)) +
  geom_bar(stat="identity")+
  scale_fill_manual(values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 45, hjust=1))+
  ggtitle("Demonstratives per text length")+
  labs(fill = "Reference-tracking device")+
  xlab("Text")+
  ylab("Number of uses")
```

```{r include=FALSE}
kna_data %>% 
  filter(anaphor_referent=='boy') %>%  
  group_by(filename) %>% 
  mutate(min_start = min(anaphor_start)) %>% 
  mutate(norm_start = anaphor_start - min_start)-> kna_data_boy
kna_data_boy$filename = str_replace(kna_data_boy$filename, '.TextGrid', '')
kna_data_boy$filename = str_replace(kna_data_boy$filename, 'kna_pears_', '')
kna_data_boy$new_filename = paste(kna_data_boy$filename, kna_data_boy$length_words, sep=':')
```

```{r echo=FALSE}
ggplot(kna_data_boy, aes(x=norm_start, y=reorder(new_filename, length_words), color=dem)) +
  geom_point(aes(shape=synt_pos), size=2)+
  ggtitle("Reference strategies for the boy")+
  theme_minimal()+
  scale_color_manual(values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77"))+
  labs(color = "Reference-tracking device", shape="Syntactic position")+
  xlab("Duration of text")+
  ylab("Referent")
```

```{r include=FALSE}
kna_data %>% 
  filter(previous_explicit_mention=='1') %>% 
  group_by(dem, role) %>% 
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))->kna_data_first
```

```{r echo=FALSE}
ggplot(kna_data_first, aes(x=factor(dem, dems_order), y=perc, fill=role)) +
  geom_bar(stat="identity")+
  theme_minimal()+
  ggtitle("Referent of the second use of a demonstrative")+
  labs(fill = "Role in text")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

```{r include=FALSE}
kna_data %>% 
  filter(synt_pos=='INDEP') %>% 
  group_by(dem, role) %>% 
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))->kna_data_role
```

```{r echo=FALSE}
ggplot(kna_data_role, aes(x=factor(dem, dems_order), y=perc, fill=role)) +
  geom_bar(stat="identity")+
  theme_minimal()+
  ggtitle("Referent of an independent demonstrative")+
  labs(fill = "Role in text")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

```{r include=FALSE}
kna_data %>% 
  filter(synt_pos=='ADNOM') %>% 
  group_by(dem, role) %>% 
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))->kna_data_role
```

```{r echo=FALSE}
ggplot(kna_data_role, aes(x=factor(dem, dems_order), y=perc, fill=role)) +
  geom_bar(stat="identity")+
  theme_minimal()+
  ggtitle("Referent of an adnominal demonstrative")+
  labs(fill = "Role in text")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

## Mehweb Dargwa

```{r include=FALSE}
mhb_data %>%
  filter(synt_pos=="INDEP") %>%
  filter(dem %in% c('PROX', 'MED', 'DIST')) %>% 
  group_by(dem, anaphor_referent) %>%
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))->mhb_data_referent
```

```{r echo=FALSE}
ggplot(mhb_data_referent, aes(x=factor(dem, dems_order), y=perc, fill=anaphor_referent)) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  #scale_fill_brewer(palette="Set1")+
  scale_fill_manual( values = c("boy" = "#2F4F4F","man" = "#D3D3D3", "boys" ="#A9A9A9",
                                "man2" = "#8A2BE2", "boy1"= "#FF69B4", "girl" = "#800080",
                                "basket" = "#006400", "bike" = "#20B2AA", "hat" = "#66CDAA", "stone" = "#87CEEB", "scarf" = "#808000","pears" = "#00008B"))+
  theme_minimal()+
  ggtitle("Independent uses")+
  labs(fill = "Referents")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

```{r include=FALSE}
mhb_data %>%
  filter(synt_pos=="ADNOM") %>%
  filter(dem %in% c('PROX', 'MED', 'DIST')) %>% 
  group_by(dem, anaphor_referent) %>%
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))->mhb_data_referent_adn
```

```{r echo=FALSE}
ggplot(mhb_data_referent_adn, aes(x=factor(dem, dems_order), y=perc, fill=anaphor_referent)) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  #scale_fill_brewer(palette="Set1")+
  scale_fill_manual( values = c("boy" = "#2F4F4F","man" = "#D3D3D3", "boys" ="#A9A9A9",
                                "man2" = "#8A2BE2", "boy1"= "#FF69B4", "girl" = "#800080",
                                "basket" = "#006400", "bike" = "#20B2AA", "hat" = "#66CDAA", "stone" = "#87CEEB", "scarf" = "#808000","pears" = "#00008B"))+
  theme_minimal()+
  ggtitle("Adnominal uses")+
  labs(fill = "Referents")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

```{r include=FALSE}
mhb_target = c('abk_1', 'zkh_3', 'ptm_8', 'kzm_4', 'isr_5', 'mgm_6')
mhb_data$filename = str_replace(mhb_data$filename, '.TextGrid', '')
mhb_data$filename = str_replace(mhb_data$filename, 'mhb_pears_', '')
mhb_data %>%
  filter(filename %in% mhb_target) %>% 
  filter(synt_pos=="INDEP") %>%
  filter(dem %in% c('PROX', 'MED', 'DIST')) %>% 
  group_by(dem, anaphor_referent) %>%
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))->mhb_data_referent
```

```{r echo=FALSE}
ggplot(mhb_data_referent, aes(x=factor(dem, dems_order), y=perc, fill=anaphor_referent)) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  #scale_fill_brewer(palette="Set1")+
  scale_fill_manual( values = c("boy" = "#2F4F4F","man" = "#D3D3D3", "boys" ="#A9A9A9",
                                "man2" = "#8A2BE2", "boy1"= "#FF69B4", "girl" = "#800080",
                                "basket" = "#006400", "bike" = "#20B2AA", "hat" = "#66CDAA", "stone" = "#87CEEB", "scarf" = "#808000","pears" = "#00008B", "tree" = "#009666", "apron" = "#115898"))+
  theme_minimal()+
  ggtitle("Independent uses (based on abk_1, zkh_3, ptm_8, kzm_4, isr_5, mgm_6)")+
  labs(fill = "Referents")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

```{r include=FALSE}
mhb_data %>%
  filter(filename %in% mhb_target) %>% 
  filter(synt_pos=="ADNOM") %>%
  filter(dem %in% c('PROX', 'MED', 'DIST')) %>% 
  group_by(dem, anaphor_referent) %>%
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))->mhb_data_referent_adn
```

```{r echo=FALSE}
ggplot(mhb_data_referent_adn, aes(x=factor(dem, dems_order), y=perc, fill=anaphor_referent)) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  #scale_fill_brewer(palette="Set1")+
  scale_fill_manual( values = c("boy" = "#2F4F4F","man" = "#D3D3D3", "boys" ="#A9A9A9",
                                "man2" = "#8A2BE2", "boy1"= "#FF69B4", "girl" = "#800080",
                                "basket" = "#006400", "bike" = "#20B2AA", "hat" = "#66CDAA", "stone" = "#87CEEB", "scarf" = "#808000","pears" = "#00008B", "tree" = "#009666", "apron" = "#115898"))+
  theme_minimal()+
  ggtitle("Adnominal uses (based on abk_1, zkh_3, ptm_8, kzm_4, isr_5, mgm_6)")+
  labs(fill = "Referents")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

```{r include=FALSE}
mhb_target = c('abk_1', 'zkh_3', 'ptm_8', 'kzm_4', 'isr_5', 'mgm_6')
mhb_data$filename = str_replace(mhb_data$filename, '.TextGrid', '')
mhb_data$filename = str_replace(mhb_data$filename, 'mhb_pears_', '')
mhb_data %>%
  filter(!filename %in% mhb_target) %>% 
  filter(synt_pos=="INDEP") %>%
  filter(dem %in% c('PROX', 'MED', 'DIST')) %>% 
  group_by(dem, anaphor_referent) %>%
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))->mhb_data_referent
```

```{r echo=FALSE}
ggplot(mhb_data_referent, aes(x=factor(dem, dems_order), y=perc, fill=anaphor_referent)) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  #scale_fill_brewer(palette="Set1")+
  scale_fill_manual( values = c("boy" = "#2F4F4F","man" = "#D3D3D3", "boys" ="#A9A9A9",
                                "man2" = "#8A2BE2", "boy1"= "#FF69B4", "girl" = "#800080",
                                "basket" = "#006400", "bike" = "#20B2AA", "hat" = "#66CDAA", "stone" = "#87CEEB", "scarf" = "#808000","pears" = "#00008B", "tree" = "#009666", "apron" = "#115898"))+
  theme_minimal()+
  ggtitle("Independent uses (based on mjs_2, zlm_9, anv_7)")+
  labs(fill = "Referents")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

```{r include=FALSE}
mhb_data %>%
  filter(!filename %in% mhb_target) %>% 
  filter(synt_pos=="ADNOM") %>%
  filter(dem %in% c('PROX', 'MED', 'DIST')) %>% 
  group_by(dem, anaphor_referent) %>%
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))->mhb_data_referent_adn
```

```{r echo=FALSE}
ggplot(mhb_data_referent_adn, aes(x=factor(dem, dems_order), y=perc, fill=anaphor_referent)) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  #scale_fill_brewer(palette="Set1")+
  scale_fill_manual( values = c("boy" = "#2F4F4F","man" = "#D3D3D3", "boys" ="#A9A9A9",
                                "man2" = "#8A2BE2", "boy1"= "#FF69B4", "girl" = "#800080",
                                "basket" = "#006400", "bike" = "#20B2AA", "hat" = "#66CDAA", "stone" = "#87CEEB", "scarf" = "#808000","pears" = "#00008B", "tree" = "#009666", "apron" = "#115898"))+
  theme_minimal()+
  ggtitle("Adnominal uses (based on mjs_2, zlm_9, anv_7)")+
  labs(fill = "Referents")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

```{r include=FALSE}
mhb_data %>%
  filter(filename %in% mhb_target) %>%
  filter(grepl('_NP|NP', previous_explicit_device))%>% 
  filter(synt_pos=="INDEP") %>% 
  filter(dem %in% c('PROX', 'MED', 'DIST')) %>% 
  group_by(dem, previous_explicit_mention) %>% 
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))-> mhb_data_mention
mhb_data_mention$previous_explicit_mention = str_replace(mhb_data_mention$previous_explicit_mention, '1', '2')

```

```{r echo=FALSE}
ggplot(mhb_data_mention, aes(x=factor(dem, dems_order), y=perc, fill=previous_explicit_mention)) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  #scale_fill_brewer(palette="Set1")+
  scale_fill_manual( values = c(">2" = "#E9999C","2" = "#AEEEEE"))+
  theme_minimal()+
  ggtitle("Independent uses (based on abk_1, zkh_3, ptm_8, kzm_4, isr_5, mgm_6)")+
  labs(fill = "Number of the mention with a demonstrative")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

```{r include=FALSE}
mhb_data %>%
  filter(filename %in% mhb_target) %>%
  filter(grepl('_NP|NP', previous_explicit_device))%>% 
  filter(synt_pos=="ADNOM") %>%
  filter(dem %in% c('PROX', 'MED', 'DIST')) %>% 
  group_by(dem, previous_explicit_mention) %>% 
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))-> mhb_data_mention
mhb_data_mention$previous_explicit_mention = str_replace(mhb_data_mention$previous_explicit_mention, '1', '2')

```

```{r echo=FALSE}
ggplot(mhb_data_mention, aes(x=factor(dem, dems_order), y=perc, fill=previous_explicit_mention)) +
  geom_bar(stat="identity", position=position_dodge())+
  geom_text(aes(label=n), vjust=1.6, color="black",
            position = position_dodge(0.9), size=3.5)+
  #scale_fill_brewer(palette="Set1")+
  scale_fill_manual( values = c(">2" = "#E9999C","2" = "#AEEEEE"))+
  theme_minimal()+
  ggtitle("Adnominal uses (based on abk_1, zkh_3, ptm_8, kzm_4, isr_5, mgm_6)")+
  labs(fill = "Number of the mention with a demonstrative")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

```{r include=FALSE}
mhb_data %>%
  group_by(filename, length_words, dem) %>%
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))-> mhb_data_length
mhb_data_length$filename = str_replace(mhb_data_length$filename, '.TextGrid', '')
mhb_data_length$filename = str_replace(mhb_data_length$filename, 'mhb_pears_', '')
mhb_data_length$new_filename = paste(mhb_data_length$filename, mhb_data_length$length_words, sep=':')
```

```{r echo=FALSE}
ggplot(mhb_data_length, aes(x=reorder(new_filename, length_words), y=n, fill=dem)) +
  geom_bar(stat="identity")+
  scale_fill_manual(values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77", "ABOVE"="#E7298A", "BELOW"="#666666"))+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 45, hjust=1))+
  ggtitle("Demonstratives per text length")+
  labs(fill = "Reference-tracking device")+
  xlab("Text")+
  ylab("Number of uses")
```

```{r include=FALSE}
mhb_data %>% 
  filter(filename %in% mhb_target) %>%
  filter(previous_explicit_mention=='1') %>% 
  group_by(dem, role) %>% 
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))->mhb_data_first
```

```{r echo=FALSE}
ggplot(mhb_data_first, aes(x=factor(dem, dems_order), y=perc, fill=role)) +
  geom_bar(stat="identity")+
  theme_minimal()+
  ggtitle("Referent of the second use of a demonstrative (based on abk_1, zkh_3, ptm_8, kzm_4, isr_5, mgm_6)")+
  labs(fill = "Role in text")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

```{r include=FALSE}
mhb_data %>%
  filter(filename %in% mhb_target) %>%
  filter(synt_pos=='INDEP') %>% 
  group_by(dem, role) %>% 
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))->mhb_data_role
```

```{r echo=FALSE}
ggplot(mhb_data_role, aes(x=factor(dem, dems_order), y=perc, fill=role)) +
  geom_bar(stat="identity")+
  theme_minimal()+
  ggtitle("Referent of an independent demonstrative (based on abk_1, zkh_3, ptm_8, kzm_4, isr_5, mgm_6)")+
  labs(fill = "Role in text")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

```{r include=FALSE}
mhb_data %>% 
  filter(filename %in% mhb_target) %>%
  filter(synt_pos=='ADNOM') %>% 
  group_by(dem, role) %>% 
  summarize(n=n()) %>% 
  mutate(perc = n / sum(n) * 100) %>% 
  mutate(total_n_ref_dev = sum(n))->mhb_data_role
```

```{r echo=FALSE}
ggplot(mhb_data_role, aes(x=factor(dem, dems_order), y=perc, fill=role)) +
  geom_bar(stat="identity")+
  theme_minimal()+
  ggtitle("Referent of an adnominal demonstrative (based on abk_1, zkh_3, ptm_8, kzm_4, isr_5, mgm_6)")+
  labs(fill = "Role in text")+
  xlab("Reference-tracking device")+
  ylab("Percentage (per ref.-track. device)")
```

```{r include=FALSE}
mhb_data %>% 
  filter(anaphor_referent=='boy') %>%  
  group_by(filename) %>% 
  mutate(min_start = min(anaphor_start)) %>% 
  mutate(norm_start = anaphor_start - min_start)-> mhb_data_boy
mhb_data_boy$filename = str_replace(mhb_data_boy$filename, '.TextGrid', '')
mhb_data_boy$filename = str_replace(mhb_data_boy$filename, 'mhb_pears_', '')
mhb_data_boy$new_filename = paste(mhb_data_boy$filename, mhb_data_boy$length_words, sep=':')
```

```{r echo=FALSE}
ggplot(mhb_data_boy, aes(x=norm_start, y=reorder(new_filename, length_words), color=dem)) +
  geom_point(aes(shape=synt_pos), size=2)+
  ggtitle("Reference strategies for the boy")+
  theme_minimal()+
  scale_color_manual(values = c("PROX" = "#7570B3","MED" = "#D95F02", "DIST" = "#1B9E77", "ABOVE"="#E7298A", "BELOW"="#666666"))+
  labs(color = "Reference-tracking device", shape="Syntactic position")+
  xlab("Duration of text")+
  ylab("Referent")

```

```{r include=FALSE}
data -> data_denc
data_denc$filename = str_replace(data_denc$filename, '.TextGrid', '')
data_denc$new_filename = paste(data_denc$filename, data_denc$length_words, sep=':')


data_denc %>% 
  group_by(filename) %>% 
  mutate(n = n()) %>% 
  mutate(denc = n / length_words * 100)->a
```

```{r echo=FALSE}
ggplot(a, aes(x=new_filename, y=denc, color=lang)) +
  geom_point()+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 45, hjust=1))+
  ggtitle("Dencity of demonstratives per text")+
  labs(color = "Language")+
  xlab("Text")+
  ylab("Dencity (n of uses per 100 words)")
```